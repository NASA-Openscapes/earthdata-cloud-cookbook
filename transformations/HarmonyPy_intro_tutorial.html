<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang=""><head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title>harmonypy_intro_tutorial</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>

  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <script src="../site_libs/quarto-nav/quarto-nav.js"></script>
  <script src="../site_libs/quarto-nav/headroom.min.js"></script>
  <meta name="quarto:offset" content="../">
  <script src="../site_libs/quarto-search/autocomplete.min.js"></script>
  <script src="../site_libs/quarto-search/fuse.min.js"></script>
  <script src="../site_libs/quarto-search/quarto-search.js"></script>
  <link href="../transformations/netcdf-to-zarr.html" rel="next">
  <link href="../transformations/harmony-api.html" rel="prev">
  <script src="../site_libs/quarto-html/quarto.js"></script>
  <script src="../site_libs/quarto-html/popper.min.js"></script>
  <script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
  <script src="../site_libs/quarto-html/clipboard.min.js"></script>
  <script src="../site_libs/quarto-html/anchor.min.js"></script>
  <script src="../site_libs/quarto-html/quarto-html.js"></script>
  <link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
  <link class="quarto-color-scheme light" href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet">
  <link class="quarto-color-scheme dark" disabled="true" href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet">
  <script src="../site_libs/bootstrap/bootstrap.min.js"></script>
  <link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
  <link class="quarto-color-scheme light" href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet">
  <link class="quarto-color-scheme dark" disabled="true" href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="stylesheet">
  <link rel="stylesheet" href="../styles.css">
</head>
<body>
<div id="quarto-search-results"></div>
<header id="quarto-header" class="headroom fixed-top">
<nav class="quarto-secondary-nav py-2 d-lg-none d-md-block " data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <div class="container-fluid d-flex justify-content-between">
    <h1 class="quarto-secondary-nav-title mb-0 fs-3 d-inline">(Untitled)</h1>
    <button type="button" class="quarto-btn-toggle btn d-lg-none py-0 px-1 d-inline-block border-0 ">
      <i class="bi bi-chevron-right"></i>
    </button>
  </div>
</nav>
</header>
 <!-- /navbar/sidebar -->
<div class="container-fluid quarto-container d-flex flex-column page-layout-article">
<div class="row flex-fill" id="quarto-content">
  <div id="quarto-sidebar" class="col col-12 col-lg-3 d-lg-flex px-0 pt-0 sidebar collapse sidebar-navigation">
    <nav class="me-lg-auto py-2 docked  overflow-scroll">
  <div class="px-3 pt-lg-2 mt-1 text-left sidebar-header sidebar-header-stacked">
    <img src="../nasa-openscapes.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">
      EarthData Cloud Cookbook
      </a>
        <div class="sidebar-tools-main">
    <a href="https://github.com/nasa-openscapes/earthdata-cloud-cookbook" title="" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle " onclick="window.quartoToggleColorScheme(); return false;"><i class="bi"></i></a>
</div>
    </div>
  </div>
    <div class="d-flex px-3 mt-2 flex-shrink-0 align-items-center">
      <div class="sidebar-search">
      <form class="d-flex mb-0">
  <input id="quarto-search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>
      </div>
        <div class="sidebar-tools-collapse">
    <a href="https://github.com/nasa-openscapes/earthdata-cloud-cookbook" title="" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle " onclick="window.quartoToggleColorScheme(); return false;"><i class="bi"></i></a>
</div>
    </div>
  <div class="sidebar-menu-container"> 
  <ul class="list-unstyled mt-3 px-3">
      <li class="sidebar-item">
  <a href="../index.html" class="">Welcome</a>
</li>
      <ul class="list-unstyled sidebar-section depth1">
    <li class="">
        <div class="me-auto ">
          <div class="d-inline-flex w-100 sidebar-section-item">
            <div class="sidebar-section-link me-auto ">
            <a href="../get-started/index.html" class="">Getting Started</a>
            </div>
            <a class="text-start  " data-bs-toggle="collapse" data-bs-target="#gettingstarted-collapse" aria-expanded="true">
              <div><i class="bi bi-chevron-right ms-2 "></i></div>
            </a>
            </div>
        </div>
      <div class="collapse  show" id="gettingstarted-collapse">
        <ul class="list-unstyled sidebar-item-contents">
          <li class="sidebar-item">
  <a href="../get-started/how-to-use.html" class="">How to use this book</a>
</li>
          <li class="sidebar-item">
  <a href="../get-started/earthdata-login.html" class="">EarthData Login</a>
</li>
          <ul class="list-unstyled sidebar-section depth2">
    <li class="">
        <div class="me-auto ">
          <div class="d-inline-flex w-100 sidebar-item">
            <div class="sidebar-section-link me-auto ">
            <a href="../get-started/authentication.html" class="">Authentication</a>
            </div>
            <a class="text-start collapsed " data-bs-toggle="collapse" data-bs-target="#authentication-collapse" aria-expanded="false">
              <div><i class="bi bi-chevron-right ms-2 "></i></div>
            </a>
            </div>
        </div>
      <div class="collapse  " id="authentication-collapse">
        <ul class="list-unstyled sidebar-item-contents">
          <li class="sidebar-item">
  <a href="../get-started/lpdaac-netrc.html" class="">LP DAAC Authentication Example</a>
</li>
          <li class="sidebar-item">
  <a href="../get-started/podaac-ecco-netrc.html" class="">PO DAAC Authentication Example</a>
</li>
        </ul>
      </div>
    </li>
  </ul>
          <li class="sidebar-item">
  <a href="../get-started/api-primer.html" class="">API Primer</a>
</li>
        </ul>
      </div>
    </li>
  </ul>
      <ul class="list-unstyled sidebar-section depth1">
    <li class="">
        <div class="me-auto ">
          <div class="d-inline-flex w-100 sidebar-section-item">
            <div class="sidebar-section-link me-auto ">
            <a href="../discovery/index.html" class="">NASA Cloud Data Discovery</a>
            </div>
            <a class="text-start  " data-bs-toggle="collapse" data-bs-target="#nasaclouddatadiscovery-collapse" aria-expanded="true">
              <div><i class="bi bi-chevron-right ms-2 "></i></div>
            </a>
            </div>
        </div>
      <div class="collapse  show" id="nasaclouddatadiscovery-collapse">
        <ul class="list-unstyled sidebar-item-contents">
          <li class="sidebar-item">
  <a href="../discovery/Navigate_CMR_STAC.html" class="">CMR and CMR-STAC API</a>
</li>
          <li class="sidebar-item">
  <a href="../discovery/earthdata-search-ui.html" class="">Earthdata Search UI</a>
</li>
          <li class="sidebar-item">
  <a href="../discovery/cmr-virtual-directories.html" class="">CMR Virtual Directories</a>
</li>
        </ul>
      </div>
    </li>
  </ul>
      <ul class="list-unstyled sidebar-section depth1">
    <li class="">
        <div class="me-auto ">
          <div class="d-inline-flex w-100 sidebar-section-item">
            <div class="sidebar-section-link me-auto ">
            <a href="../access/index.html" class="">NASA Cloud Data Access</a>
            </div>
            <a class="text-start  " data-bs-toggle="collapse" data-bs-target="#nasaclouddataaccess-collapse" aria-expanded="true">
              <div><i class="bi bi-chevron-right ms-2 "></i></div>
            </a>
            </div>
        </div>
      <div class="collapse  show" id="nasaclouddataaccess-collapse">
        <ul class="list-unstyled sidebar-item-contents">
          <li class="sidebar-item">
  <a href="../access/data-access-example.html" class="">Data access demo</a>
</li>
          <li class="sidebar-item">
  <a href="../access/earthdata-search.html" class="">Earthdata Search</a>
</li>
          <li class="sidebar-item">
  <a href="../access/opendap-cloud.html" class="">OPeNDAP in the Cloud</a>
</li>
          <ul class="list-unstyled sidebar-section depth2">
    <li class="">
        <div class="me-auto ">
          <div class="d-inline-flex w-100 sidebar-item">
            <div class="sidebar-section-link me-auto ">
            <a href="../access/direct-in-region.html" class="">Direct in-region</a>
            </div>
            <a class="text-start collapsed " data-bs-toggle="collapse" data-bs-target="#directin-region-collapse" aria-expanded="false">
              <div><i class="bi bi-chevron-right ms-2 "></i></div>
            </a>
            </div>
        </div>
      <div class="collapse  " id="directin-region-collapse">
        <ul class="list-unstyled sidebar-item-contents">
          <li class="sidebar-item">
  <a href="../access/podaac-ecco-data_access-cloud_direct_access_s3.html" class="">Direct access to ECCO data in S3 (from *us-west-2*)</a>
</li>
        </ul>
      </div>
    </li>
  </ul>
          <li class="sidebar-item">
  <a href="../access/cof-via-harmony.html" class="">COF via Earthdata Harmony</a>
</li>
          <li class="sidebar-item">
  <a href="../access/download-to-local.html" class="">Download to local</a>
</li>
        </ul>
      </div>
    </li>
  </ul>
      <ul class="list-unstyled sidebar-section depth1">
    <li class="">
        <div class="me-auto ">
          <div class="d-inline-flex w-100 sidebar-section-item">
            <div class="sidebar-section-link me-auto ">
            <a href="../transformations/index.html" class="">NASA Cloud Data Transformations</a>
            </div>
            <a class="text-start  " data-bs-toggle="collapse" data-bs-target="#nasaclouddatatransformations-collapse" aria-expanded="true">
              <div><i class="bi bi-chevron-right ms-2 "></i></div>
            </a>
            </div>
        </div>
      <div class="collapse  show" id="nasaclouddatatransformations-collapse">
        <ul class="list-unstyled sidebar-item-contents">
          <li class="sidebar-item">
  <a href="../transformations/harmony-api.html" class="">Harmony API</a>
</li>
          <li class="sidebar-item">
  <a href="../transformations/HarmonyPy_intro_tutorial.html" class="active">HarmonyPy Introduction</a>
</li>
          <li class="sidebar-item">
  <a href="../transformations/netcdf-to-zarr.html" class="">netCDF to Zarr</a>
</li>
          <ul class="list-unstyled sidebar-section depth2">
    <li class="">
        <div class="me-auto ">
          <div class="d-inline-flex w-100 sidebar-item">
            <div class="sidebar-section-link me-auto ">
            <a href="../transformations/L2-subsetter.html" class="">L2 Subsetter</a>
            </div>
            <a class="text-start collapsed " data-bs-toggle="collapse" data-bs-target="#l2subsetter-collapse" aria-expanded="false">
              <div><i class="bi bi-chevron-right ms-2 "></i></div>
            </a>
            </div>
        </div>
      <div class="collapse  " id="l2subsetter-collapse">
        <ul class="list-unstyled sidebar-item-contents">
          <li class="sidebar-item">
  <a href="../transformations/harmony-subsetting.html" class="">Harmony Subsetting</a>
</li>
        </ul>
      </div>
    </li>
  </ul>
          <li class="sidebar-item">
  <a href="../transformations/earthdata-search.html" class="">Earthdata Search UI</a>
</li>
          <li class="sidebar-item">
  <a href="../transformations/opendap-cloud.html" class="">OPeNDAP in the Cloud</a>
</li>
        </ul>
      </div>
    </li>
  </ul>
      <ul class="list-unstyled sidebar-section depth1">
    <li class="">
        <div class="me-auto ">
          <div class="d-inline-flex w-100 sidebar-section-item">
            <div class="sidebar-section-link me-auto ">
            <a href="../examples/index.html" class="">End-to-end Examples</a>
            </div>
            <a class="text-start  " data-bs-toggle="collapse" data-bs-target="#end-to-endexamples-collapse" aria-expanded="true">
              <div><i class="bi bi-chevron-right ms-2 "></i></div>
            </a>
            </div>
        </div>
      <div class="collapse  show" id="end-to-endexamples-collapse">
        <ul class="list-unstyled sidebar-item-contents">
          <li class="sidebar-item">
  <a href="../examples/python-example.html" class="">Python example with Quarto</a>
</li>
          <li class="sidebar-item">
  <a href="../examples/r-example.html" class="">RMarkdown example .Rmd</a>
</li>
          <li class="sidebar-item">
  <a href="../examples/notebook-example.html" class="">Notebook example</a>
</li>
        </ul>
      </div>
    </li>
  </ul>
      <ul class="list-unstyled sidebar-section depth1">
    <li class="">
        <div class="me-auto ">
          <div class="d-inline-flex w-100 sidebar-section-item">
            <div class="sidebar-section-link me-auto ">
            <a href="../appendix/index.html" class="">Appendix</a>
            </div>
            <a class="text-start  " data-bs-toggle="collapse" data-bs-target="#appendix-collapse" aria-expanded="true">
              <div><i class="bi bi-chevron-right ms-2 "></i></div>
            </a>
            </div>
        </div>
      <div class="collapse  show" id="appendix-collapse">
        <ul class="list-unstyled sidebar-item-contents">
          <li class="sidebar-item">
  <a href="../appendix/about.html" class="">About</a>
</li>
          <li class="sidebar-item">
  <a href="../appendix/glossary.html" class="">Glossary</a>
</li>
          <li class="sidebar-item">
  <a href="../transformations/harmonypy.html" class="">Harmony Py Library</a>
</li>
        </ul>
      </div>
    </li>
  </ul>
      <ul class="list-unstyled sidebar-section depth1">
    <li class="">
        <div class="me-auto ">
          <div class="d-inline-flex w-100 sidebar-section-item">
            <div class="sidebar-section-link me-auto ">
            <a href="../contributing/index.html" class="">Contributing</a>
            </div>
            <a class="text-start  " data-bs-toggle="collapse" data-bs-target="#contributing-collapse" aria-expanded="true">
              <div><i class="bi bi-chevron-right ms-2 "></i></div>
            </a>
            </div>
        </div>
      <div class="collapse  show" id="contributing-collapse">
        <ul class="list-unstyled sidebar-item-contents">
          <li class="sidebar-item">
  <a href="../contributing/setup.html" class="">Initial Setup</a>
</li>
          <li class="sidebar-item">
  <a href="../contributing/workflow.html" class="">Workflow</a>
</li>
        </ul>
      </div>
    </li>
  </ul>
  </ul>
  </div>
</nav>
  </div>
  <div id="quarto-toc-sidebar" class="col col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-toc order-last"><nav id="TOC" role="doc-toc">
<h2 id="toc-title">On this page</h2>
<ul>
<li><a href="#harmonypy-introduction" class="nav-link active" data-scroll-target="#harmonypy-introduction">HarmonyPy Introduction</a>
<ul class="collapse">
<li><a href="#import-packages" class="nav-link" data-scroll-target="#import-packages">Import packages</a></li>
<li><a href="#quick-start" class="nav-link" data-scroll-target="#quick-start">Quick start</a></li>
<li><a href="#create-harmony-client-object" class="nav-link" data-scroll-target="#create-harmony-client-object">Create Harmony Client object</a></li>
<li><a href="#create-harmony-request" class="nav-link" data-scroll-target="#create-harmony-request">Create Harmony Request</a></li>
<li><a href="#check-request-validity" class="nav-link" data-scroll-target="#check-request-validity">Check Request validity</a></li>
<li><a href="#submit-request" class="nav-link" data-scroll-target="#submit-request">Submit Request</a></li>
<li><a href="#check-request-status" class="nav-link" data-scroll-target="#check-request-status">Check Request status</a></li>
<li><a href="#view-harmony-job-response-and-output-urls" class="nav-link" data-scroll-target="#view-harmony-job-response-and-output-urls">View Harmony job response and output URLs</a></li>
<li><a href="#download-and-visualize-harmony-output-files" class="nav-link" data-scroll-target="#download-and-visualize-harmony-output-files">Download and visualize Harmony output files</a></li>
<li><a href="#visualize-downloaded-outputs" class="nav-link" data-scroll-target="#visualize-downloaded-outputs">Visualize Downloaded Outputs</a></li>
<li><a href="#explore-output-stac-catalog-and-retrieve-results-from-s3" class="nav-link" data-scroll-target="#explore-output-stac-catalog-and-retrieve-results-from-s3">Explore output STAC catalog and retrieve results from s3</a></li>
<li><a href="#cloud-in-place-access" class="nav-link" data-scroll-target="#cloud-in-place-access">Cloud in-place access</a></li>
</ul></li>
</ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/nasa-openscapes/earthdata-cloud-cookbook/edit/main/transformations/HarmonyPy_intro_tutorial.ipynb">Edit this page</a></p><p><a href="https://github.com/nasa-openscapes/earthdata-cloud-cookbook/issues/new">Report an issue</a></p></div></div></nav></div>
  <div class="col mx-auto col-sm-12 col-md-9 col-lg-7 px-lg-4">
<main>

<section id="harmonypy-introduction" class="level2">
<h2 class="anchored" data-anchor-id="harmonypy-introduction">HarmonyPy Introduction</h2>
<p>This notebook demonstrates several basic examples highlighting how to query and access customized data outputs from NASA Earthdata Harmony. See https://harmony-py.readthedocs.io/en/latest/ for detailed documentation on HarmonyPy.</p>
<section id="import-packages" class="level3">
<h3 class="anchored" data-anchor-id="import-packages">Import packages</h3>
<p>First we import packages needed to request and visualize our data, as well as the <code>harmony-py</code> library itself. Make sure to install <code>harmony-py</code> and its dependencies into your current Python environment prior to executing the notebook:</p>
<pre><code>$ pip install -U harmony-py 
</code></pre>
<p>You can install this and any other necessary libraries directly into your Jupyter notebook Python kernel as well:</p>
<pre><code>!{sys.executable} -m pip install -U harmony-py</code></pre>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># !{sys.executable} -m pip install -U harmony-py #install harmony-py into Python kernel</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys<span class="op">;</span> sys.path.append(<span class="st">'..'</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> datetime <span class="im">as</span> dt</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> display, JSON</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rasterio</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rasterio.plot</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> harmony <span class="im">import</span> BBox, Client, Collection, Request</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> harmony.config <span class="im">import</span> Environment</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="quick-start" class="level3">
<h3 class="anchored" data-anchor-id="quick-start">Quick start</h3>
<p>You can request and download data using <code>harmony-py</code> in just a few easy lines. Although more advanced subsetting and transformation options may be supported on your data product of interest, this example below demonstrates a basic spatial bounding box and temporal range request, using the direct download method:</p>
<pre><code>harmony_client = Client(auth=('EDL_username', 'EDL_password'))
request = Request(
    collection=Collection(id=dataset_short_name),
    spatial=BBox(w, s, e, n),
    temporal={
        'start': dt.datetime(yyyy, mm, dd),
        'stop': dt.datetime(yyyy, mm, dd)
    }
)
job_id = harmony_client.submit(request)
results = harmony_client.download_all(job_id, directory='/tmp', overwrite=True)</code></pre>
<p>The guidance below offers more detailed examples highlighting many of the helpful features provided by the Harmony Py library, including direct s3 access from Earthdata Cloud-hosted data if running in the AWS us-west-2 region.</p>
</section>
<section id="create-harmony-client-object" class="level3">
<h3 class="anchored" data-anchor-id="create-harmony-client-object">Create Harmony Client object</h3>
<p>First, you will need to create your Harmony Client, which is what you will interact with to submit and inspect a data request to Harmony, as well as to retrieve your results.</p>
<p>When creating the Client, you need to provide your <a href="https://urs.earthdata.nasa.gov">Earthdata Login</a> credentials, which are required to access data from NASA EOSDIS. There are three options for providing your Earthdata Login username and password:</p>
<ol type="1">
<li>Provide your username and password directly when creating the client:</li>
</ol>
<pre><code>harmony_client = Client(auth=('captainmarvel', 'marve10u5'))</code></pre>
<ol start="2" type="1">
<li>Set your credentials using environment variables:</li>
</ol>
<p>You can either export these directly:</p>
<pre><code>$ export EDL_USERNAME='captainmarvel'
$ export EDL_PASSWORD='marve10u5'</code></pre>
<p>Or by storing them in a .env file, which operates in a similar fashion to .netrc. You will need to store the file in your current working directory and it must be named .env with the following format:</p>
<pre><code>EDL_USERNAME=myusername
EDL_PASSWORD=mypass</code></pre>
<ol start="3" type="1">
<li>Use a .netrc file:</li>
</ol>
<p>Create a .netrc file in your home directory, using the example below:</p>
<pre><code>machine urs.earthdata.nasa.gov
login captainmarvel
password marve10u5</code></pre>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>harmony_client <span class="op">=</span> Client() <span class="co"># assumes .netrc usage, option 3 above</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="create-harmony-request" class="level3">
<h3 class="anchored" data-anchor-id="create-harmony-request">Create Harmony Request</h3>
<p>The following are common request parameters:</p>
<ul>
<li><code>collection</code>: Required parameter. This is the NASA EOSDIS collection, or data product. There are two options for inputting a collection of interest:
<ol type="1">
<li>Provide a concept ID, which is an ID provided in the Common Metadata Repository (CMR) metadata</li>
<li>Data product short name (e.g.&nbsp;SENTINEL-1_INTERFEROGRAMS).</li>
</ol></li>
<li><code>spatial</code>: Bounding box spatial constraints on the data. The Harmony <code>Bbox</code> class accepts spatial coordinates as decimal degrees in w, s, e, n order, where longitude = -180, 180 and latitude = -90, 90.<br>
</li>
<li><code>shape</code>: Perform a shapefile subsetting request on a supported collection by passing the path to a GeoJSON file (*.json or .geojson), an ESRI Shapefile (.zip or .shz), or a kml file (.kml) as the “shape” parameter</li>
<li><code>temporal</code>: Date/time constraints on the data. The example below demonstrates temporal start and end ranges using the python <code>datetime</code> library.</li>
</ul>
<p>Other advanced parameters that may be of interest. Note that many reformatting or advanced projection options may not be available for your requested dataset. See the <a href="https://harmony-py.readthedocs.io/en/latest/">documentation</a> for details on how to construct these parameters.</p>
<ul>
<li><code>crs</code>: Reproject the output coverage to the given CRS. Recognizes CRS types that can be inferred by gdal, including EPSG codes, Proj4 strings, and OGC URLs (http://www.opengis.net/def/crs/…)</li>
<li><code>interpolation</code>: specify the interpolation method used during reprojection and scaling</li>
<li><code>scale_extent</code>: scale the resulting coverage either among one axis to a given extent</li>
<li><code>scale_size</code>: scale the resulting coverage either among one axis to a given size</li>
<li><code>granule_id</code>: The CMR Granule ID for the granule (file) which should be retrieved</li>
<li><code>width</code>: number of columns to return in the output coverage</li>
<li><code>height</code>: number of rows to return in the output coverage</li>
<li><code>format</code>: the output mime type to return</li>
<li><code>max_results</code>: limits the number of input files processed in the request</li>
</ul>
<p>The example utilized in this tutorial demonstrates a shapefile subset of the Big Island of Hawaii on February 24, 2020. A bounding box subset over the Mauna Kea and Mauna Loa volcanoes is also commented out below to show a similar subsetting option. The SENTINEL-1_INTERFEROGRAMS dataset, distributed by the ASF DAAC, is a prototype Level 2 NISAR-Format product. See https://asf.alaska.edu/data-sets/derived-data-sets/sentinel-1-interferograms/ for more information.</p>
<p>This request specifies a subset of the unwrappedPhase variable, in TIFF format, with a maximum file result capped at 2 for demonstration purposes.</p>
<section id="note-that-a-sentinel-3-end-user-license-agreement-eula-is-required-to-access-these-data." class="level4">
<h4 class="anchored" data-anchor-id="note-that-a-sentinel-3-end-user-license-agreement-eula-is-required-to-access-these-data."><strong><em>Note that a Sentinel-3 End-User License Agreement (EULA) is required to access these data.</em></strong></h4>
</section>
<section id="please-go-to-httpsgrfn.asf.alaska.edudoordownloads1-gunw-d-r-021-tops-20201029_20191029-033636-28753n_27426n-pp-2dde-v2_0_3.nc-to-initiate-a-file-download-which-will-first-prompt-you-to-accept-the-required-eula-if-you-have-not-already-done-so.-if-you-do-not-accept-this-eula-you-will-receive-an-error-when-submitting-your-harmony-request." class="level4">
<h4 class="anchored" data-anchor-id="please-go-to-httpsgrfn.asf.alaska.edudoordownloads1-gunw-d-r-021-tops-20201029_20191029-033636-28753n_27426n-pp-2dde-v2_0_3.nc-to-initiate-a-file-download-which-will-first-prompt-you-to-accept-the-required-eula-if-you-have-not-already-done-so.-if-you-do-not-accept-this-eula-you-will-receive-an-error-when-submitting-your-harmony-request."><strong><em>Please go to https://grfn.asf.alaska.edu/door/download/S1-GUNW-D-R-021-tops-20201029_20191029-033636-28753N_27426N-PP-2dde-v2_0_3.nc to initiate a file download, which will first prompt you to accept the required EULA if you have not already done so. If you do not accept this EULA, you will receive an error when submitting your Harmony request.</em></strong></h4>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>shapefile_path <span class="op">=</span> <span class="st">'Big_Island_0005.zip'</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>request <span class="op">=</span> Request(</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    collection<span class="op">=</span>Collection(<span class="bu">id</span><span class="op">=</span><span class="st">'SENTINEL-1_INTERFEROGRAMS'</span>),</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">#spatial=BBox(-155.75, 19.26, -155.3, 19.94), # bounding box example that can be used as an alternative to shapefile input</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    shape<span class="op">=</span>shapefile_path,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    temporal<span class="op">=</span>{</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">'start'</span>: dt.datetime(<span class="dv">2020</span>, <span class="dv">2</span>, <span class="dv">24</span>),</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">'stop'</span>: dt.datetime(<span class="dv">2020</span>, <span class="dv">2</span>, <span class="dv">25</span>),</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    variables<span class="op">=</span>[<span class="st">'science/grids/data/unwrappedPhase'</span>],</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">format</span><span class="op">=</span><span class="st">'image/tiff'</span>,</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    max_results<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="check-request-validity" class="level3">
<h3 class="anchored" data-anchor-id="check-request-validity">Check Request validity</h3>
<p>Before submitting a Harmony Request, you can test your request to see if it’s valid and how to fix it if not. In particular, <code>request.is_valid</code> will check to ensure that your spatial BBox bounds and temporal ranges are entered correctly.</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Request valid? </span><span class="sc">{</span>request<span class="sc">.</span>is_valid()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> m <span class="kw">in</span> request.error_messages():</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">" * "</span> <span class="op">+</span> m)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="submit-request" class="level3">
<h3 class="anchored" data-anchor-id="submit-request">Submit Request</h3>
<p>Once you have created your request, you can now submit it to Harmony using the Harmony Client object. A job id is returned, which is a unique identifier that represents your submitted request.</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>job_id <span class="op">=</span> harmony_client.submit(request)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>job_id</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="check-request-status" class="level3">
<h3 class="anchored" data-anchor-id="check-request-status">Check Request status</h3>
<p>You can check on the progress of a processing job with <code>status()</code>. This method blocks while communicating with the server but returns quickly. The JSON helper function provides a nicer formatting option for viewing the status message.</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>JSON(harmony_client.status(job_id))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Depending on the size of the request, you may want to wait until the request has completed processing before the remainder of your code is executed. The <code>wait_for_processing()</code> method will block subsequent lines of code while optinally showing a progress bar.</p>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>harmony_client.wait_for_processing(job_id, show_progress<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="view-harmony-job-response-and-output-urls" class="level3">
<h3 class="anchored" data-anchor-id="view-harmony-job-response-and-output-urls">View Harmony job response and output URLs</h3>
<p>Once your data request has finished processing, you can view details on the job that was submitted to Harmony, including the API call to Harmony, and informational messages on your request if available.</p>
<p><code>result_json()</code> calls <code>wait_for_processing()</code> and returns the complete job in JSON format once processing is complete. You may optionally show the progress bar using the same <code>show_progress=True</code> statement in the previous line.</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> harmony_client.result_json(job_id)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>JSON(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="download-and-visualize-harmony-output-files" class="level3">
<h3 class="anchored" data-anchor-id="download-and-visualize-harmony-output-files">Download and visualize Harmony output files</h3>
<p>The files returned from your request are returned as HTTPS URLs in all cases other than when requesting Zarr as an output format(s3 URLs are returned instead to support accessing and interacting with those outputs in the cloud). For all Harmony requests, direct s3 URLs are also provided within a STAC catalog provided in the job response as we’ll explore in more detail below.</p>
<section id="retrieve-list-of-output-urls" class="level4">
<h4 class="anchored" data-anchor-id="retrieve-list-of-output-urls">Retrieve list of output URLs</h4>
<p>The <code>result_urls()</code> method calls <code>wait_for_processing()</code> and returns a list of the processed data URLs once processing is complete. You may optionally show the progress bar as shown below.</p>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>urls <span class="op">=</span> harmony_client.result_urls(job_id, show_progress<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>urls</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="download-files" class="level4">
<h4 class="anchored" data-anchor-id="download-files">Download files</h4>
<p>The next code block utilizes <code>download_all()</code> to download all data output file URLs. This is a non-blocking step during the download itself, but this line will block subsequent code while waiting for the job to finish processing. You can optionally specify a directory and specify whether to overwrite existing files as shown below.</p>
<p>You may call <code>result()</code> on future objects (those that are awaiting processing) to realize them. A call to <code>result()</code> blocks until that particular future object finishes downloading. Other future objects will download in the background, in parallel. When downloading is complete, the future objects will return the file path string of the file that was just downloaded. This file path can then be fed into other libraries that may read the data files and perform other operations.</p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> harmony_client.download_all(job_id, directory<span class="op">=</span><span class="st">'/tmp'</span>, overwrite<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>file_names <span class="op">=</span> [f.result() <span class="cf">for</span> f <span class="kw">in</span> results]</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>file_names</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With <code>download()</code>, this will download only the URL specified, in case you would like more control over individual files.</p>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>file_name <span class="op">=</span> harmony_client.download(urls[<span class="dv">0</span>], overwrite<span class="op">=</span><span class="va">True</span>).result()</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>file_name</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="visualize-downloaded-outputs" class="level3">
<h3 class="anchored" data-anchor-id="visualize-downloaded-outputs">Visualize Downloaded Outputs</h3>
<p>The output image files can be visualized using the <code>Rasterio</code> library.</p>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> r <span class="kw">in</span> results:</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    rasterio.plot.show(rasterio.<span class="bu">open</span>(r.result()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="explore-output-stac-catalog-and-retrieve-results-from-s3" class="level3">
<h3 class="anchored" data-anchor-id="explore-output-stac-catalog-and-retrieve-results-from-s3">Explore output STAC catalog and retrieve results from s3</h3>
<p>A <a href="https://stacspec.org/">STAC</a> catalog is returned in each Harmony request result. The stac items include not only the s3 locations for each output file, but also the spatial and temporal metadata representing each subsetted output. <code>stac_catalog_url</code> will return the URL of the catalog, and can also accept an optional progress status if desired.</p>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>stac_catalog_url <span class="op">=</span> harmony_client.stac_catalog_url(job_id)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>stac_catalog_url</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="using-pystac" class="level4">
<h4 class="anchored" data-anchor-id="using-pystac">Using PySTAC:</h4>
<p>Following the directions for PySTAC (https://pystac.readthedocs.io/en/latest/quickstart.html), we can hook our harmony-py client into STAC_IO.</p>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> urllib.parse <span class="im">import</span> urlparse</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pystac <span class="im">import</span> STAC_IO</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> requests_read_method(uri):</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    parsed <span class="op">=</span> urlparse(uri)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> parsed.hostname.startswith(<span class="st">'harmony.'</span>):</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> harmony_client.read_text(uri)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> STAC_IO.default_read_text_method(uri)</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>STAC_IO.read_text_method <span class="op">=</span> requests_read_method</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>View the timestamp and s3 locations of each STAC item:</p>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pystac <span class="im">import</span> Catalog</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>cat <span class="op">=</span> Catalog.from_file(stac_catalog_url)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(cat.title)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>s3_links <span class="op">=</span> []</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> item <span class="kw">in</span> cat.get_all_items():</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(item.datetime, [asset.href <span class="cf">for</span> asset <span class="kw">in</span> item.assets.values()])</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    s3_links.append([asset.href <span class="cf">for</span> asset <span class="kw">in</span> item.assets.values()])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="using-intake-stac" class="level4">
<h4 class="anchored" data-anchor-id="using-intake-stac">Using intake-stac:</h4>
<p>View each item value returned:</p>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> intake</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>cat <span class="op">=</span> intake.open_stac_catalog(stac_catalog_url)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>display(<span class="bu">list</span>(cat))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And the metadata contents of each item:</p>
<div class="cell">
<div class="sourceCode" id="cb24"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>entries <span class="op">=</span> []</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="bu">id</span>, entry <span class="kw">in</span> cat.search(<span class="st">'type'</span>).items():</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    display(entry)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    entries.append(entry)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="cloud-in-place-access" class="level3">
<h3 class="anchored" data-anchor-id="cloud-in-place-access">Cloud in-place access</h3>
<p><strong>Note that the remainder of this tutorial will only succeed when running this notebook within the AWS us-west-2 region.</strong></p>
<p>Harmony data outputs can be accessed within the cloud using the s3 URLs and AWS credentials provided in the Harmony job response. Below are examples using both <code>intake-stac</code> or <code>boto3</code> to access the data in the cloud.</p>
<section id="aws-credential-retrieval" class="level4">
<h4 class="anchored" data-anchor-id="aws-credential-retrieval">AWS credential retrieval</h4>
<p>Using <code>aws_credentials</code> you can retrieve the credentials needed to access the Harmony s3 staging bucket and its contents.</p>
<div class="cell">
<div class="sourceCode" id="cb25"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>creds <span class="op">=</span> harmony_client.aws_credentials()</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>creds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="using-boto3" class="level4">
<h4 class="anchored" data-anchor-id="using-boto3">Using boto3</h4>
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">NOTE</span><span class="co">: Execution of this cell will only succeed within the AWS us-west-2 region. </span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> boto3</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>s3 <span class="op">=</span> boto3.client(<span class="st">'s3'</span>, <span class="op">**</span>creds)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(s3_links)):</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>    uri <span class="op">=</span> s3_links[i][<span class="dv">0</span>]</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>    bucket <span class="op">=</span> uri.split(<span class="st">'/'</span>)[<span class="dv">2</span>]</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>    obj <span class="op">=</span> <span class="st">'/'</span>.join(uri.split(<span class="st">'/'</span>)[<span class="dv">3</span>:])</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>    fn <span class="op">=</span> uri.split(<span class="st">'/'</span>)[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(fn, <span class="st">'wb'</span>) <span class="im">as</span> f:</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>        s3.download_fileobj(bucket, obj, f)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="using-intake-stac-1" class="level4">
<h4 class="anchored" data-anchor-id="using-intake-stac-1">Using intake-stac</h4>
<p>Once again, you can use <code>intake-stac</code> to directly access each output from Harmony in AWS. Viewing the file structure and plotting the image can be done in a few simple lines when working with the data in-region:</p>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">NOTE</span><span class="co">: Execution of this cell will only succeed within the AWS us-west-2 region. </span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(<span class="bu">list</span>(cat))):</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    da <span class="op">=</span> cat[<span class="bu">list</span>(cat)[i]][entries[i].describe()[<span class="st">'name'</span>]].to_dask()</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    display(da)</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    da.plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!-- -->
</section>
</section>
</section>
</main>
<div class="page-navigation page-navigation-docked">
  <div class="nav-page nav-page-previous">
      <a href="../transformations/harmony-api.html">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Harmony API</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../transformations/netcdf-to-zarr.html">
        <span class="nav-page-text">netCDF to Zarr</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</div>
</div> <!-- /main column -->
</div> <!-- /row -->
</div> <!-- /container fluid -->


</body></html>